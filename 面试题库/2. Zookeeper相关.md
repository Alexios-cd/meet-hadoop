### 1.简述ZooKeeper

ZooKeeper是一个分布式的开源协调服务，由于它提供的高可用性、可靠性和集中式服务发现等特性，被广泛应用于分布式系统中。ZooKeeper通常被用来协调分布式应用中的各个节点，包括**协调分布式锁**、**分布式队列**、**分布式配置**等场景。

以下是一些ZooKeeper的特点：

1. **分布式协调服务**：ZooKeeper旨在解决分布式应用中的各种协调问题，包括领导者选举、分布式锁、分布式队列等。
2. **高可用性和可靠性**：ZooKeeper使用ZAB协议来提供高可用性和可靠性。ZAB协议能够保证在ZooKeeper集群中只有一个Leader，其他节点则作为Follower或Observer。Leader负责维护数据的一致性，并将写请求广播给其他节点。
3. **集中式服务发现**：ZooKeeper能够为分布式系统提供集中式的服务发现功能，应用可以通过ZooKeeper注册服务并查询其他服务的位置信息。
4. **数据一致性**：ZooKeeper将所有数据存储在内存中，使用WAL（Write Ahead Log）来保证数据的一致性和持久性。
5. **应用简单**：ZooKeeper提供了丰富的API，使得应用程序可以简单地使用ZooKeeper来实现分布式应用中的各种协调问题。

总之，ZooKeeper是一个重要的分布式协调服务，能够为分布式系统提供高可用性、可靠性、集中式服务发现和数据一致性等特性，是分布式系统中必不可少的组件之一。

### 2.Zookeeper选举机制

ZooKeeper选举机制是保证ZooKeeper服务高可用性的重要手段之一。ZooKeeper集群中，只有一个节点充当Leader角色，负责处理客户端的请求，并维护数据的一致性。如果Leader节点出现故障，ZooKeeper需要通过选举机制选出一个新的Leader节点。

以下是ZooKeeper选举机制的流程：

1. 所有ZooKeeper节点都尝试获取Leader权利。
2. 如果节点之前参加过选举，那么节点会尝试使用之前的选举ID和ZXID（ZooKeeper事务ID）重新参加选举；否则，节点会生成一个新的选举ID和ZXID。
3. 每个节点会向其他节点发送选举投票，包含选举ID、ZXID和节点ID等信息。
4. 节点会对收到的投票进行统计，如果有节点收到了超过半数的投票，那么该节点就成为新的Leader节点。
5. 如果没有任何一个节点收到超过半数的投票，那么所有节点都会重新发起新一轮的选举，重复以上步骤。

在ZooKeeper选举机制中，选举ID是用于表示一个选举周期的唯一标识，ZXID则是表示ZooKeeper事务的全局唯一标识，用于判断事务的先后顺序。节点ID则是用于区分不同节点的唯一标识。

ZooKeeper选举机制的核心是通过投票来选举新的Leader节点，并且只有在收到超过半数的投票时才会选举成功。因此，节点数量必须是奇数，才能保证选举结果的唯一性和正确性。

- 每个ZooKeeper节点在选举的时候可以选举自己，但是只有在它获得大多数节点的支持时，才会成为 leader。
- 在一次选举中，每个节点只能投票给一个候选者。如果一个节点在一次选举中投了多个候选者的票，那么这个节点的选票会被视为无效。

